<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Accès Médical</title>

<link rel="icon" href="https://i.imgur.com/ZtAo0te.png">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#020617,#0f172a);
  font-family:Arial,sans-serif;
  color:#e5e7eb;
}
.card{
  width:360px;
  background:#020617;
  padding:30px;
  border-radius:14px;
  box-shadow:0 0 40px rgba(0,0,0,.6);
  text-align:center;
}
.logo{
  width:120px;
  margin-bottom:15px;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}
input{
  background:#020617;
  color:white;
  border:1px solid #334155;
}
button{
  background:#2563eb;
  color:white;
  cursor:pointer;
  font-weight:bold;
}
button:disabled{
  opacity:.6;
  cursor:not-allowed;
}
hr{
  border:none;
  border-top:1px solid #334155;
  margin:25px 0;
}
</style>
</head>

<body>

<div class="card">
  <img src="https://i.imgur.com/ZtAo0te.png" class="logo" alt="Logo">

  <h2>Service Médical</h2>

  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Mot de passe">
  <button id="loginBtn" onclick="login()">Connexion</button>

  <hr>

  <h3>Accès citoyen</h3>
  <input id="nom" placeholder="Nom Prénom">
  <input id="code" placeholder="Code Discord">
  <button id="codeBtn" onclick="sendCode()">Recevoir le code</button>
  <button id="verifyBtn" onclick="verify()">Valider</button>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbym1G5HzrOmRPn0_33SZXpshUzNitMh2DOzDNDCYUSsx83aGG93WuFPvdPwhV3Mhn_Y/exec";

function setLoading(btn,state){
  btn.disabled=state;
  btn.innerText=state?"Chargement...":btn.dataset.text;
}
document.querySelectorAll("button").forEach(b=>b.dataset.text=b.innerText);

function login(){
  setLoading(loginBtn,true);
  fetch(API,{method:"POST",body:JSON.stringify({
    action:"login",username:username.value,password:password.value
  })})
  .then(r=>r.json())
  .then(d=>{
    setLoading(loginBtn,false);
    if(!d.ok) return alert("Connexion refusée");
    localStorage.setItem("user",username.value);
    localStorage.setItem("permission",d.permission);
    location.href="index.html";
  });
}

function sendCode(){
  setLoading(codeBtn,true);
  fetch(API,{method:"POST",body:JSON.stringify({
    action:"sendCode",nom:nom.value
  })}).then(()=>{
    setLoading(codeBtn,false);
    alert("Code envoyé sur Discord");
  });
}

function verify(){
  setLoading(verifyBtn,true);
  fetch(API,{method:"POST",body:JSON.stringify({
    action:"verify",nom:nom.value,code:code.value
  })})
  .then(r=>r.json())
  .then(d=>{
    setLoading(verifyBtn,false);
    if(!d.ok) return alert("Code invalide");
    localStorage.setItem("viewer",JSON.stringify(d));
    location.href="index.html";
  });
}
</script>

</body>
</html>
