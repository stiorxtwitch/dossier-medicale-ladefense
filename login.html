<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Connexion MÃ©dicale</title>
<style>
body {
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card {
  background:#020617;
  padding:25px;
  border-radius:12px;
  width:320px;
}
input, button {
  width:100%;
  padding:10px;
  margin-top:10px;
  border:none;
  border-radius:6px;
}
button {
  background:#2563eb;
  color:white;
  cursor:pointer;
}
button.secondary {
  background:#334155;
}
</style>
</head>
<body>

<div class="card">
  <h2>ðŸ©º Connexion MÃ©dic</h2>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Mot de passe">
  <button onclick="login()">Se connecter</button>

  <hr style="margin:20px 0;">

  <button class="secondary" onclick="viewer()">
    ðŸ‘¤ Visualiser mon dossier mÃ©dical
  </button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyeo31L1H09ZbPy2AOmty1cYWbz_ffU1pAH0C9S6MjjNPdkw0rSCrKUCm9uFRsPVKaL/exec";

function login(){
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"login",
      username:username.value,
      password:password.value
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(!d.ok) return alert("Connexion refusÃ©e");
    localStorage.setItem("user", username.value);
    localStorage.setItem("permission", d.permission);
    location.href="index.html";
  });
}

function viewer(){
  const nom = prompt("Nom PrÃ©nom");
  if(!nom) return;

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({action:"sendCode", nom})
  }).then(()=>{
    const code = prompt("Code reÃ§u sur Discord");
    fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({action:"verify", nom, code})
    })
    .then(r=>r.json())
    .then(d=>{
      if(!d.ok) return alert("Code invalide");
      localStorage.setItem("viewer", JSON.stringify(d));
      location.href="index.html";
    });
  });
}
</script>

</body>
</html>
